# Intel 4004
The Intel 4004 has a very simple structure compared to the current chips, or even compared to the NES. Let's start from the outside and work our way in.
## Pins
The chip has 16 pins able to be connected to the motherboard to send data to other parts of the board.
### Data Bus
This is simply four wires that send and recieve data from other components on the board. Everything that needs to talk to the CPU uses these 4 wires to communicate.
The CPU does not need to know what data it is receiving (that's the job of the programmer), but in order for the components to know if it's being sent data, the CPU
has other pins that do the job.
### CM-ROM
This wire is typically connected to 16 ROM chips. This limit can be expanded through the use of I/O ports, simple gates on the motherboard, and software, but it is much
harder and slower to work with. It is used to communicate to the ROM that an address from the CPU is being sent. It only needs to be a single wire connected to all the
ROM chips because the first 4 bits sent to the ROMs are the chip number, which specifies the chip that reads the address. This is different from how CM-RAM works.
### CM-RAM
These 4 wires are used either by themselves to select from 4 groups of 4 RAM chips (16), or they use a 3-to-7-bit decoder that allows for 8 groups of 4 RAM chips (32).
Selecting which wires to enable and using them to communicate with the RAMs is done through software.
### Clock Phase 1 & 2
These are generated outside of the CPU using a clock generator, and a single use of both is considered one "cycle". They communicate with components on the board to help
with timing. There is very little documentation with most of the components on how exactly they are used to time things, which is why I hesitate to call this emulator
sub-cycle accurate, however, I do use the idea of them in my emulator to make communication between devices smoother.
### Sync
This is a single input used to ensure components on the board don't deviate from the current cycle. The CPU needs each component to be on the same time as itself in order
to communicate the information it needs with any degree of effectiveness.
### Test
Able to be checked using an instruction. Could be used for a number of things, including verification of successful communication of different chips. While not implemented
in the emulator, it should be rather simple to "connect" this pin with any component you want.
### Reset
A single input that sets all registers and flags to 0. While not required for an emulator for more than a single cycle, this is held for 64 cycles as it is when the
original 4004 is first powered on.
## Timing
There are parts in the CPU that deal with time: the control area and the instruction decoder. The control area deals with the pins, which is simply an input to the clock.
The instruction decoder allows the CPU to work on "instruction cycles," which are 8 clock cycles long.
### Cycles A1-A3
These cycles are for the sole purpose of send the 12-bit program counter to the ROM, from high to low nibble. The first nibble can be considered the ROM chip number, as
that is how it is represented on the board.
### Cycles M1-M2
These cycles are used for the ROM to send data to the CPU. It sends an 8-bit number from high to low. Notably, ROM chips connected directly to the CPU can only hold
instructions, as that is the only information the CPU asks for when talking to the ROM.
### Cycles X1-X3
These are for the CPU to interpret the instruction. This is also when the CPU communicates with RAM and ROM/RAM I/O ports.
## The ALU
The ALU (Arithmetic Logic Unit) is where the CPU does its math. It does very little, only adding and subtracting. It uses the 4-bit accumulator, as well as a temporary register containing the specified normal register sent in the command. It also contains a standard carry flag as well as a decimal adjust unit, which sets the carry bit if a number is above 9 and uses it and the resulting accumulator as a decimal number.
## The Stack
The 4004 has 4 12-bit stack registers. The first stack register is the program counter. The whole stack can be shifted up for a function call, or shifted down for a return, but be aware that more than 3 internal function calls breaks this system.
## The Registers
The 4004 has 16 4-bit registers, labeled 0-F. Occasionally, they are used as 8 8-bit registers when working with certain commands.
## The Bus
The 4004's bus is a 4-bit buffer that connects directly to the data bus pins.

[Prev](1_Getting-Started.md) | [Next](3_Intel-4001.md)
